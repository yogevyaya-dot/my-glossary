---
import { getCollection } from 'astro:content';

// 1. Get all entries
const allEntries = await getCollection('glossary');

// 2. Sort A-Z
allEntries.sort((a, b) => a.data.title.localeCompare(b.data.title));

// 3. Group by First Letter
const grouped = allEntries.reduce((acc, entry) => {
  const firstLetter = entry.data.title.charAt(0).toUpperCase();
  const letterKey = /[a-zA-Z]/.test(firstLetter) ? firstLetter : '#';
  
  if (!acc[letterKey]) acc[letterKey] = [];
  acc[letterKey].push(entry);
  return acc;
}, {});

const sortedKeys = Object.keys(grouped).sort();
---

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>The Complete Glossary</title>
    <meta name="viewport" content="width=device-width" />
    <style>
      body {
        font-family: 'Segoe UI', sans-serif;
        max-width: 900px;
        margin: 0 auto;
        padding: 40px 20px;
        background-color: #f8f9fa;
        color: #333;
      }
      h1 { text-align: center; font-size: 3rem; margin-bottom: 10px; }
      p.subtitle { text-align: center; color: #666; margin-bottom: 40px; }
      
      /* Navigation Bar */
      .alphabet-nav {
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
        gap: 8px;
        margin-bottom: 50px;
        padding: 20px;
        background: white;
        border-radius: 50px;
        box-shadow: 0 4px 15px rgba(0,0,0,0.05);
      }
      .alphabet-nav a {
        width: 30px;
        height: 30px;
        display: flex;
        align-items: center;
        justify-content: center;
        text-decoration: none;
        color: #555;
        font-weight: bold;
        border-radius: 50%;
        transition: 0.2s;
      }
      .alphabet-nav a:hover { background: #0066cc; color: white; transform: scale(1.1); }

      /* Letter Sections */
      .letter-section {
        background: white;
        padding: 30px;
        margin-bottom: 30px;
        border-radius: 12px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.03);
      }
      .letter-title {
        border-bottom: 2px solid #f0f0f0;
        padding-bottom: 10px;
        margin-top: 0;
        color: #0066cc;
        font-size: 2rem;
      }
      .term-list {
        list-style: none;
        padding: 0;
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
        gap: 15px;
      }
      .term-list a {
        text-decoration: none;
        color: #444;
        font-size: 1.1rem;
        display: block;
        padding: 8px 0;
        transition: color 0.2s;
      }
      .term-list a:hover { color: #0066cc; padding-left: 5px; }
    </style>
  </head>
  <body>
    <h1>Glossary</h1>
    <p class="subtitle">A comprehensive list of terms from A to Z</p>

    <div class="alphabet-nav">
      {sortedKeys.map((letter) => (
        <a href={`#letter-${letter}`}>{letter}</a>
      ))}
    </div>

    {sortedKeys.map((letter) => (
      <div id={`letter-${letter}`} class="letter-section">
        <h2 class="letter-title">{letter}</h2>
        <ul class="term-list">
          {grouped[letter].map((entry) => (
            <li>
              <a href={`/${entry.slug}`}>{entry.data.title}</a>
            </li>
          ))}
        </ul>
      </div>
    ))}
  </body>
</html>